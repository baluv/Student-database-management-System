$.fn.serializeObject=function(){var i={},e=this.serializeArray();return $.each(e,function(){i[this.name]?(i[this.name].push||(i[this.name]=[i[this.name]]),i[this.name].push(this.value||"")):i[this.name]=this.value||""}),i},function(){function i(){t.each(function(){$(this).change(e)})}function e(i){var e=$(i.target).siblings("input").first();"password"===e.attr("type")?e.attr("type","text"):e.attr("type","password")}var t=$(".show-password");i()}();var LoginSettings={init:function(){_.extend(this,AJAXUtil),this.bindToElements(),this._storeTimeOnPageStartTime(),this.loadGitHubDetailsCookie(),this.activateErrorMessagesForPrefilledInputs(),"#forgot-password"===document.location.hash&&this.toggleForgotPassword()},bindToElements:function(){$("#login-signup-form")._on("submit",this.doSignup,this),$("#login-login-form")._on("submit",this.doLogin,this),$("#login-with-github")._on("click",this.disableWithGitHubButton,this,!0),$("#forgot-password-link")._on("click",this.toggleForgotPassword,this),$("#forgot-password-form")._on("submit",this.sendForgotPasswordEmail,this),$("#signup-username-field")._on("keyup",this.showUsernameURLPreview,this),$("#signup-email-field")._on("blur",this.checkOnExistingEmail,this),$("#signup-username-field")._on("blur",this.checkOnExistingUsername,this),$("#github-login-tab")._on("click",this.activateGitHubLoginTab,this)},loadGitHubDetailsCookie:function(){var i=JSON.parse($.cookie("github_details"));for(var e in i)i[e]&&$("#signup-"+e+"-field").val(i[e]);$.removeCookie("github_details")},activateErrorMessagesForPrefilledInputs:function(){$("#signup-username-field").keyup()},toggleForgotPassword:function(){$("#forgot-password-form").slideToggle()},sendForgotPasswordEmail:function(){var i=$("#forgot-email");""==i.val()?($("#sent-message").show(),$("#sent-message-message").html("<p style='color: red;'>Gotta put an email in there, hoss.</p>")):($("#forgot-email-btn").attr("disabled","disabled"),this._storeTimeOnPageInCookie(),this.post("/forgotpassword",{email:$("#forgot-email").val()},this.doneSendForgotPasswordEmail,this.failedSendForgotPasswordEmail))},doneSendForgotPasswordEmail:function(i){$("#forgot-email-btn").attr("disabled",!1),$("#sent-message-message").html(i.message),$("#sent-message").show()},failedSendForgotPasswordEmail:function(i){$("#forgot-email-btn").attr("disabled",!1),$("#sent-message-message").html(i.errors.message),$("#sent-message").show()},showUsernameURLPreview:function(){$("#url-preview").addClass("selected").text($("#signup-username-field").val())},checkOnExistingEmail:function(i,e){var t=e.val();if(t){var s={email:t,check_type:"email"};this._storeTimeOnPageInCookie(),this.post("/login/signup/dupcheck",s,this.doneCheckOnExistingEmail)}},doneCheckOnExistingEmail:function(i){this.clearInputElErrors("email"),this.addInputElError(i,"email")},checkOnExistingUsername:function(i,e){var t=e.val();if(t){var s={username:t,check_type:"username"};this._storeTimeOnPageInCookie(),this.post("/login/signup/dupcheck",s,this.doneCheckOnExistingUsername)}},doneCheckOnExistingUsername:function(i){this.clearInputElErrors("username"),this.addInputElError(i,"username")},clearInputElErrors:function(i){$("#signup-"+i).removeClass("error"),$("#signup-"+i+" .error-message").remove()},addInputElError:function(i,e){if(i.exists){var t="<div class='error-message'>"+i.message+"</div>";$("#signup-"+e).append(t).addClass("error")}},doSignup:function(){$("#signup-submit").attr("disabled","disabled");var i=$("#login-signup-form").serializeObject();this._storeTimeOnPageInCookie(),this.action="signup",this.post("/login/signup",i,this.doneSignup,this.failedSignup)},doneSignup:function(i){document.location=i.redirect_to},failedSignup:function(i){$("#signup-submit").attr("disabled",!1),this.showErrors(i)},doLogin:function(){$("#log-in-button").addClass("in-action"),this.action="login",this._storeTimeOnPageInCookie();var i=$("#login-login-form").serializeObject();this.post("/login/login",i,this.doneLogin,this.showErrors)},doneLogin:function(i){document.location=i.redirect_to},disableWithGitHubButton:function(i,e){e.attr("disabled","disabled"),e.unbind()._on("click",_.noop),e.html("Logging in with GitHub...")},activateGitHubLoginTab:function(i){_activate_tab(i,$("#login-tab"),"")},_storeTimeOnPageStartTime:function(){this.timeOnPageStartTime=(new Date).getTime()},_storeTimeOnPageInCookie:function(){$.cookie("time_on_page",this._calcTimeOnPage(),{expires:1,path:"/"})},_calcTimeOnPage:function(){var i=(new Date).getTime();return i-this.timeOnPageStartTime},showErrors:function(i){$("#log-in-button").removeClass("in-action"),this.clearErrors();for(var e in i.errors){var t=i.errors[e][0],s="<div class='error-message'>"+t+"</div>";$("#"+this.action+"-"+e).append(s).addClass("error")}"password"in i.errors&&$("#login-password-field_").focus().select()},clearErrors:function(){$(".error-message").remove(),$(".error").removeClass("error")}};LoginSettings.init();